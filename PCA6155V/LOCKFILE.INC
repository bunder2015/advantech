; STRINGS
LOCKF   DB "C:\PCA6155V\WD.LCK",ZST
NOLOCK1 DB "LOCKFILE EXISTS, EXITING!",CR,LF,CR,LF,DST
NOLOCK2 DB "ERROR CREATING LOCKFILE, EXITING!",CR,LF,CR,LF,DST
OKLOCK  DB "LOCKFILE CREATED SUCCESSFULLY.",CR,LF,DST

; VARIABLES
LOCKH   DB ?    ; LOCKFILE HANDLE

LOCKFILE:
; CHECK FOR EXISTING LOCKFILE
    MOV DX,OFFSET LOCKF
    MOV AX,3D00H
    INT 21H

    JNC LOCKERR1

; LOCKFILE DID NOT EXIST, CREATE ONE
    MOV DX,OFFSET LOCKF
    MOV CX,00H
    MOV AH,3CH
    INT 21H

    JC LOCKERR2

; CLOSE FILE HANDLE
    MOV LOCKH,AL
    MOV BX,WORD PTR [LOCKH]
    MOV AH,3EH
    INT 21H

; PRINT LOCK SUCCESS
    MOV DX,OFFSET OKLOCK
    MOV AH,09H
    INT 21H

    RET

LOCKERR1:
; EXISTING FILE - CLOSE FILE HANDLE, PRINT ERROR, EXIT
    MOV LOCKH,AL
    MOV BX,WORD PTR [LOCKH]
    MOV AH,3EH
    INT 21H

    MOV DX,OFFSET NOLOCK1
    MOV AH,09H
    INT 21H

    MOV AX,4C02H
    INT 21H

LOCKERR2:
; CREATE ERROR - PRINT ERROR, EXIT
    MOV DX,OFFSET NOLOCK2
    MOV AH,09H
    INT 21H

    MOV AX,4C02H
    INT 21H
