; CONSTANTS
PORT    EQU 443H    ; IO PORT OF WATCHDOG
TSKIP   EQU 8       ; TIMER TICKS BETWEEN WATCHDOG TICKS (8*0.055S=0.44S)

; VARIABLES
OLDVEC  DD ?        ; OLD TIMER IRQ VECTOR
TIME    DB 05H      ; SECONDS (1-63) BEFORE WATCHDOG RESETS
TTICK   DB TSKIP    ; CURRENT TIMER TICK

TICKWD:
; TICK THE WATCHDOG EVERY (TSKIP * 0.055) SECONDS
    PUSHA
    PUSHF

    DEC CS:TTICK
    JNZ JUMPOLD
    MOV CS:TTICK,TSKIP

    MOV AL,CS:TIME
    MOV DX,PORT
    OUT DX,AL

JUMPOLD:
    POPF
    POPA

; JUMP TO OLD VECTOR
    JMP FAR [CS]:OLDVEC
