; STRINGS
RBMSG   DB "CMD: REBOOT MACHINE WITH WATCHDOG...",NEWLN
RWMSG   DB "CMD: SET WATCHDOG TIMEOUT TO ",DST
SECMSG2 DB " SECONDS...",NEWLN
SWMSG   DB "CMD: STOP WATCHDOG...",NEWLN
WTMSG   DB "CMD: GET WATCHDOG TIMEOUT...",NEWLN
WTMSG1  DB "INFO: WATCHDOG TIMEOUT SET TO ",DST
WTMSG2  DB "INFO: WATCHDOG TIMER IS CURRENTLY STOPPED...",NEWLN

RUNWD:
; PRINT MESSAGE
    MOV DX,OFFSET RWMSG
    MOV AH,09H
    INT 21H

; PRINT TIMEOUT
    MOV DL,BYTE PTR CS:ATIME
    MOV AH,02H
    INT 21H

    MOV DL,BYTE PTR CS:ATIME+1
    MOV AH,02H
    INT 21H

; FINISH MESSAGE
    MOV DX,OFFSET SECMSG2
    MOV AH,09H
    INT 21H

; SEND WATCHDOG TIMEOUT TO TSR
    MOV AX,"RW"
    MOV BL,CS:HTIME
    INT 98H
    CALL CMDCHECK

    JMP ENDMAIN

GETWT:
; PRINT MESSAGE
    MOV DX,OFFSET WTMSG
    MOV AH,09H
    INT 21H

; GET WATCHDOG TIMEOUT FROM TSR
    MOV AX,"WT"
    INT 98H
    CALL CMDCHECK

    CMP BL,00H
    JNE .G1

; WATCHDOG IS CURRENTLY STOPPED
    MOV DX,OFFSET WTMSG2
    MOV AH,09H
    INT 21H

    JMP ENDMAIN
.G1:
; CONVERT HEX TIMEOUT FROM WATCHDOG
    CMP BL,09H
    JA .G2

; ASCII ENCODE SINGLE DIGIT AND STORE
    MOV CS:ATIME,00H
    ADD BL,30H
    MOV BYTE PTR CS:ATIME,BL

    JMP .G3
.G2:
; SPLIT TWO DIGITS
    MOV AH,00H
    MOV AL,BL
    MOV BL,0AH
    DIV BL

; ADD ASCII ENCODING AND STORE
    ADD AL,30H
    ADD AH,30H

    MOV BYTE PTR ATIME+1,AL
    MOV BYTE PTR ATIME,AH
.G3:
; PRINT MESSAGE
    MOV DX,OFFSET WTMSG1
    MOV AH,09H
    INT 21H

; PRINT TIMEOUT
    MOV DL,BYTE PTR CS:ATIME+1
    MOV AH,02H
    INT 21H

    MOV DL,BYTE PTR CS:ATIME
    MOV AH,02H
    INT 21H

; FINISH MESSAGE
    MOV DX,OFFSET SECMSG2
    MOV AH,09H
    INT 21H

    JMP ENDMAIN

STOPWD:
; PRINT MESSAGE
    MOV DX,OFFSET SWMSG
    MOV AH,09H
    INT 21H

; TELL TSR TO STOP WATCHDOG
    MOV AX,"SW"
    INT 98H
    CALL CMDCHECK

    JMP ENDMAIN

REBOOTWD:
; PRINT MESSAGE
    MOV DX,OFFSET RBMSG
    MOV AH,09H
    INT 21H

; TELL TSR TO REBOOT MACHINE WITH WATCHDOG
    MOV AX,"RB"
    INT 98H
    CALL CMDCHECK

    JMP ENDMAIN

; MORE TSR COMMANDS HERE?
; JMP ENDMAIN
